<html>
  <head>
    <style type="text/css" media="all"
      tal:content="string:@import url(${context/portal_url}/++resource++cpsmailaccess.css);"/>
    <style type="text/css" media="all"
      tal:content="string:@import url(${context/portal_url}/nuxeo_css2.css);"/>
    <script type="text/javascript"
      tal:attributes="src string:${context/portal_url}/++resource++cpsmailaccess.js;"
      src="++resource++cpsmailaccess.js">
    </script>
    <script type="text/javascript" src="epoz_script_main.js">
    </script>
  </head>
  <body tal:define="base_url here/getBaseUrl">
  <div class="currentRecipients"
             tal:define="containers here/getEditorContainers;
                         Tos containers/To|python:[];
                         Ccs containers/Cc|python:[];
                         BCcs containers/BCc|python:[]">
    <span style="font-size: 12">
      <input style="float:right"
               class="standalone" type="button" onclick="closeDirectoryPicker()" value="Fermer"/>
      <h4>
        <img src="cpsma_users.png"/>&#160;Recipients

      </h4>

    <div class="recipientSection">
      <h3>To</h3>
      <tal:block tal:repeat="To Tos">
        <span tal:replace="To"/>
      </tal:block>
    </div>
    <div class="recipientSection">
      <h3>Cc</h3>
      <tal:block tal:repeat="Cc Ccs">
        <span tal:replace="Cc"/>
      </tal:block>
    </div>
    <div class="recipientSection">
      <h3>BCc</h3>
      <tal:block tal:repeat="BCc BCcs">
        <span tal:replace="BCc"/>
      </tal:block>
    </div>
    </span>
  </div>
  <div style="clear: both"/>
  <div class="adders">
    <span style="font-size: 12">
        <h4>
        <img src="cpsma_users.png"/>&#160;add users
        </h4>
        <div tal:define="public python:here.getEntries()[0];
                    private python:here.getEntries()[1]">


        <tal:block tal:repeat="result private">
          <tal:block tal:define="user python:result[1]">
            <div>
              <span tal:replace="user/fullname"/>&#160;&lt;<span tal:replace="user/email"/>&gt;
              <a tal:attributes="href python:'addRecipient?content=%s&type=To&redirect=%s'
                                              % (user['email'], 'selectRecipients.html')">
              To
              </a>&#160;
              <a tal:attributes="href python:'addRecipient?content=%s&type=Cc&redirect=%s'
                                              % (user['email'], 'selectRecipients.html')">
              Cc
              </a>&#160;
              <a tal:attributes="href python:'addRecipient?content=%s&type=BCc&redirect=%s'
                                              % (user['email'], 'selectRecipients.html')">
               BCc
              </a>
            </div>
          </tal:block>
        </tal:block>


        <tal:block tal:repeat="result public">
          <tal:block tal:define="user python:result[1]">
            <div>
              <span tal:replace="user/fullname"/>&#160;&lt;<span tal:replace="user/email"/>&gt;
              <a tal:attributes="href python:'addRecipient?content=%s&type=To&redirect=%s'
                                              % (user['email'], 'selectRecipients.html')">
              To
              </a>&#160;
              <a tal:attributes="href python:'addRecipient?content=%s&type=Cc&redirect=%s'
                                              % (user['email'], 'selectRecipients.html')">
              Cc
              </a>&#160;
              <a tal:attributes="href python:'addRecipient?content=%s&type=BCc&redirect=%s'
                                              % (user['email'], 'selectRecipients.html')">
               BCc
              </a>
            </div>
          </tal:block>
        </tal:block>

        </div>
      </span>
    <br/>
    <span style="font-size: 12">
    <form action="selectRecipients.html" m3ethod="post"
            name="form" enctype="multipart/form-data">
        <input type="text" tal:attributes="value request/email|nothing" name="email"/>

        <input class="standalone" type="submit" value="Search more" name="search_submitted"/>
    </form>
    <tal:block tal:condition="request/search_submitted|python:0">

        <tal:block tal:define="email request/email;
                            results python:here.searchUsers(email)">
            <hr/>
            <tal:block tal:repeat="result results">
            <tal:block tal:define="user python:result[1]">
             <div>
              <span tal:replace="user/fullname"/>&#160;&lt;<span tal:replace="user/email"/>&gt;
              <a tal:attributes="href python:'addRecipient?content=%s&type=To&redirect=%s'
                                              % (user['email'], 'selectRecipients.html')">
              To
              </a>&#160;
              <a tal:attributes="href python:'addRecipient?content=%s&type=Cc&redirect=%s'
                                              % (user['email'], 'selectRecipients.html')">
              Cc
              </a>&#160;
              <a tal:attributes="href python:'addRecipient?content=%s&type=BCc&redirect=%s'
                                              % (user['email'], 'selectRecipients.html')">
               BCc
              </a>
            </div>
            </tal:block>
            </tal:block>
        </tal:block>
    </tal:block>
    </span>
  </div>
  </body>
</html>
