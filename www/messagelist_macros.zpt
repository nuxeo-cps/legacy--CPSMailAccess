<html>
  <body>
    <metal:block define-macro="search_messagelist">
        <table id="tableMessageList">
          <tr class="mailHeaders">
            <th class="mailToolBarElement mailToolBarInsideElement">
                  Subject
            </th>
            <th class="mailToolBarElement mailToolBarInsideElement">
              Sender
            </th>
            <th class="mailToolBarElement mailToolBarInsideElement">
              Date
            </th>
          </tr>
          <tr tal:repeat="result results">
            <td>
              <img src="cpsma_message.png"/>
              <a tal:attributes="href python:result['path']+'/view'">
                <span class="truncable" tal:content="result/Subject|string:?"/>
              </a>
            </td>
            <td>
              <a tal:attributes="href python:result['path']+'/view'">
                <span class="truncable" tal:content="result/From|string:?"/>
              </a>
            </td>
            <td>
              <a tal:attributes="href python:result['path']+'/view'">
                <span class="truncable" tal:content="result/Date|string:?"/>
              </a>
            </td>
          </tr>
        </table>
    </metal:block>

    <metal:block define-macro="messagelist">
    <tal:block tal:define="messages view/renderMailList;">
       <div tal:attributes="class
              python:test(is_folder,'folder_msglist','message_msglist')">
        <table id="tableMessageList">
          <tr class="mailHeaders">
            <th class="mailToolBarElement mailToolBarInsideElement">
                  Subject
            </th>
            <th class="mailToolBarElement mailToolBarInsideElement">
              Sender
            </th>
            <th class="mailToolBarElement mailToolBarInsideElement">
              Date
            </th>
          </tr>
          <tal:block tal:repeat="message messages">
          <metal:block tal:define="is_current
                python:here.absolute_url()+'/view'==message['url'];
                odd repeat/message/odd;
                class_selected python:test(odd, 'selected_odd', 'selected_even');
                class_not_selected python:test(odd,
                    'not_selected_odd', 'not_selected_even');
                gotoUrl python:message['url']+'?showfolders=1';
                onmouseover python:'setCursor(this)'+chr(59);
                onclickurl python:'gotoUrl('+chr(34)+gotoUrl+chr(34)+')';
                divclass python:test(is_current, class_selected, class_not_selected)">
          <tr tal:attributes="class
              python:test(odd, 'line_selectable_odd', 'line_selectable_even');">
            <td>
              <input type="hidden" name="sorter" id="sorter"
                     tal:attributes="value message/title"/>
              <div tal:attributes="class divclass;
                                   onclick onclickurl;
                                   onmouseover onmouseover">
                <input type="checkbox" tal:attributes="name python:'msg_'+message['uid']"
                  tal:condition="content_managment"/>
                <img src="cpsma_attach_mini.png" tal:condition="message/attachments"/>
                <img tal:attributes="src message/icon"
                    src="cpsma_message.png"/>
                <a tal:attributes="href python:message['url']+'?showfolders=1'">
                  <span class="truncable" tal:content="message/title"/>
                </a>
              </div>
            </td>
            <td>
              <input type="hidden" name="sorter" id="sorter"
                     tal:attributes="value message/From|python:''"/>
              <div tal:attributes="class divclass;
                                   onclick onclickurl;
                                   onmouseover onmouseover">
                <a tal:attributes="href python:message['url']+'?showfolders=1'">
                  <span class="truncable" tal:content="message/From|string:?"/>
                </a>
             </div>
            </td>
            <td>
              <input type="hidden" name="sorter" id="sorter"
                    tal:attributes="value message/FullDate|python:0"/>
              <div tal:attributes="class divclass;
                                   onclick onclickurl;
                                   onmouseover onmouseover">
                <a tal:attributes="href python:message['url']+'?showfolders=1'">
                  <span class="truncable" tal:content="message/Date|string:?"/>
                </a>
              </div>
            </td>
          </tr>
          </metal:block>
          </tal:block>
        </table>
        </div>
    </tal:block>
    </metal:block>

    <metal:block define-macro="messagetoolbar">
      <div class="mailToolBar">
          <a style="float: right; margin-right: 4px"
            tal:attributes="href python:here.absolute_url()+'/viewAlone.html'" target="_blank">
            <img id="new_page" src="launch.png"/>
          </a>
          <!--
          <a style="float: right; margin-right: 4px"
            tal:attributes="href python:here.absolute_url()+'/delete'">
            <img id="new_page" src="cpsma_mini_mail_delete.png"/>
          </a>
          <a style="float: right; margin-right: 4px"
            tal:attributes="href python:here.absolute_url()+'/forward'">
            <img id="new_page" src="cpsma_mini_mail_forward.png"/>
          </a>
          <a style="float: right; margin-right: 4px"
            tal:attributes="href python:here.absolute_url()+'/reply_all'">
            <img id="new_page" src="cpsma_mini_mail_replyall.png"/>
          </a>
          <a style="float: right; margin-right: 4px"
            tal:attributes="href python:here.absolute_url()+'/reply'">
            <img id="new_page" src="cpsma_mini_mailreply.png"/>
          </a>
          -->
        <tal:block tal:condition="not:request/showfolders|python:0">
            <a tal:attributes="href python:here.absolute_url()+'/view?showfolders=1'">
              <img id="midPageButton" src="cpsma_down.png" style="margin-right: 4px"/>
            </a>
        </tal:block>
        <tal:block tal:condition="request/showfolders|python:0">
            <a tal:attributes="href python:here.absolute_url()+'/view'">
            <img id="fullPageButton" src="cpsma_up.png" style="margin-right: 4px"/>
            </a>
        </tal:block>

        </div>
    </metal:block>

    <metal:block define-macro="messageheaders">
    <img id="imgMailMoreInfos" src="cpsma_lessinfos.png"
               onclick="switchMailHeadersState();"/>
          <div id="mailLessInfos">

          <div id="mailSubject">
            <b>
              <tal:block i18n:translate="">Subject :</tal:block>
              <tal:block tal:replace="structure view/renderSubject" />
            </b>
          </div>
        </div>
        <div id="mailBreak"/>
        <div id="mailMoreInfos">
          <div id="mailDate">
            <b>
              <tal:block i18n:translate="">Date :</tal:block>
              <tal:block tal:replace="view/renderDate" />
            </b>
          </div>
          <div id="mailFrom" tal:condition="python:view.fromCount()>0">
            <b>
              <tal:block i18n:translate="">From :</tal:block>
              <a tal:attributes="href python:'view#'">
                <tal:block tal:replace="view/renderFromList" />
              </a>
            </b>
          </div>
          <div id="mailTo" tal:condition="python:view.toCount()>0">
            <b>
              <tal:block i18n:translate="">To :</tal:block>
              <a tal:attributes="href python:'view#'">
                <tal:block tal:replace="view/renderToList" />
              </a>
            </b>
          </div>
          <div id="mailCc" tal:condition="python:view.ccCount()>0">
            <b>
              <tal:block i18n:translate="">Cc :</tal:block>
              <a tal:attributes="href python:'view#'">
                <tal:block tal:replace="view/renderCcList" />
              </a>
            </b>
          </div>
        </div>
      </metal:block>
  </body>
</html>