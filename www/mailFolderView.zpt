<html metal:use-macro="here/main_template/macros/master">
  <metal:block fill-slot="css_slot">
    <style type="text/css" media="all"
      tal:content="string:@import url(${context/portal_url}/++resource++cpsmailaccess.css);"/>
  </metal:block>
  <metal:main fill-slot="javascript_head_slot">
    <script type="text/javascript"
      tal:attributes="src string:${context/portal_url}/++resource++pdlib.js;"
      src="++resource++pdlib.js">
    </script>
    <script type="text/javascript"
      tal:attributes="src string:${context/portal_url}/++resource++cpsmailaccess.js;"
      src="++resource++cpsmailaccess.js">
    </script>
    <script type="text/javascript"
      tal:attributes="src string:${context/portal_url}/++resource++sorttable.js;"
      src="++resource++sorttable.js">
    </script>
  </metal:main>
  <metal:block metal:fill-slot="main"
              tal:define="edit_name request/edit_name|nothing;
                          add_folder request/add_folder|nothing;
                          move_folder request/move_folder|nothing;
                          keep_last_sort request/keep_last_sort|python:0;
                          content_managment request/manage_content|nothing;
                          clipboard not:here/clipBoardEmpty;
                          max_folder_size here/getMaxFolderSize;
                          synchro python:here.getMailBox().isSynchronizing();
                          show_content_toolbar python:content_managment or clipboard">

    <div class="message" tal:condition="synchro" i18n:translate="cps_synchronizing">
    While the box is beeing synchronized, webmail features are limited to browsing.
    </div>
    <div tal:condition="edit_name">
     <a href="view"
        class="close_rename_form"
        title="close">
        <img src="cpsma_delete_file.png"/>
     </a>
     <form action="rename.html" method="post" class="rename_form"
          tal:define="max_size_reached_msg string:'max_size_reached';
                      js_snip python:'controlInputSize(this, %s, event, %s)' % (max_folder_size,
                       max_size_reached_msg)">
       <input type="text" name="new_name" id="new_name"
              tal:attributes="value here/simpleFolderName;
                              onkeyup js_snip"/>
       <input type="submit" name="submit" value="cpsma_change"  i18n:attributes="value"/>
     </form>
    </div>
    <div tal:condition="add_folder">
     <a href="view"
        class="close_rename_form"
        title="close">
        <img src="cpsma_delete_file.png"/>
     </a>
     <form action="addFolder.html" method="post" class="rename_form"
          tal:define="max_size_reached_msg string:max_size_reached;
                      js_snip python:'controlInputSize(this, %s, event, %s)' % (max_folder_size,
                      max_size_reached_msg)">
       <input type="text" name="name" value=""
              tal:attributes="onkeyup js_snip"/>
       <input type="submit" name="submit" value="cpsma_add" i18n:attributes="value"/>
     </form>
    </div>
    <div tal:condition="move_folder">
      <a href="view"
         class="close_rename_form"
         title="close">
        <img src="cpsma_delete_file.png"/>
      </a>
      <div class="rename_form">
        <metal:block use-macro="here/boxes_mailaccess/macros/basebox_moveview"/>
      </div>
    </div>

    <div id="maillist"
         tal:define="is_folder python:1">
      <tal:block tal:condition="show_content_toolbar">
        <form action="manageContent.html" method="post">
          <a href="view"
            class="close_rename_form"
            title="close">
            <img src="cpsma_delete_file.png"/>
          </a>
          <div class="rename_form">
            <div class="form_title"><span i18n:translate="cpsma_make_selection">
            Make a selection and choose an action</span>
              <tal:block tal:condition="clipboard">
                <tal:block tal:define="count here/clipBoardCount">
                  <tal:block tal:condition="python:count &gt; 1">
                    (<span tal:replace="count"/>
                     <span i18n:translate="cpsma_messages_in_clipboard">
                      messages in clipboard</span>)
                  </tal:block>
                  <tal:block tal:condition="python:count == 1">
                    (1 <span i18n:translate="cpsma_message_in_clipboard">
                    message in clipboard</span>)
                  </tal:block>
                </tal:block>
              </tal:block>
            </div>

            <input class="manage_copy" type="submit" name="action" value="copy"
                i18n:attributes="name"/>
            <input class="manage_cut" type="submit" name="action" value="cut"
                i18n:attributes="name"/>
            <input class="manage_paste" type="submit" name="action" value="paste"
                i18n:attributes="name"/>
            <input class="manage_delete" type="submit" name="action" value="delete"
                i18n:attributes="name"/>
            <input class="manage_selectall" type="button" name="selectall"
                   value="select all"
                   onclick="selectAllMessages(this)" i18n:attributes="name"/>
            <tal:block tal:condition="clipboard">
              <input class="manage_delete" type="submit" name="action" value="clear"
                i18n:attributes="name"/>
            </tal:block>
          </div>
          <metal:block use-macro="here/messagelist_macros/messagelist"/>
        </form>
      </tal:block>
      <tal:block tal:condition="not:show_content_toolbar">
        <metal:block use-macro="here/messagelist_macros/messagelist"/>
      </tal:block>
      <script langage="javascript">
        truncateFields(32);
        pd_setupPage();
      </script>
    </div>
  </metal:block>
</html>