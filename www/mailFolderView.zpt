<html metal:use-macro="here/main_template/macros/master">
  <metal:block fill-slot="css_slot">
    <style type="text/css" media="all"
      tal:content="string:@import url(${context/portal_url}/++resource++cpsmailaccess.css);"/>
  </metal:block>
  <metal:main fill-slot="javascript_head_slot">
    <script type="text/javascript"
      tal:attributes="src string:${context/portal_url}/++resource++pdlib.js;"
      src="++resource++pdlib.js">
    </script>
    <script type="text/javascript"
      tal:attributes="src string:${context/portal_url}/++resource++cpsmailaccess.js;"
      src="++resource++cpsmailaccess.js">
    </script>
    <script type="text/javascript"
      tal:attributes="src string:${context/portal_url}/++resource++sorttable.js;"
      src="++resource++sorttable.js">
    </script>
  </metal:main>
  <metal:block metal:fill-slot="main"
              tal:define="edit_name request/edit_name|nothing;
                          add_folder request/add_folder|nothing;
                          move_folder request/move_folder|nothing;
                          keep_last_sort request/keep_last_sort|python:0;
                          content_managment python:1;
                          clipboard not:here/clipBoardEmpty;
                          max_folder_size here/getMaxFolderSize;
                          synchro python:here.getMailBox().isSynchronizing();
                          is_folder python:1;
                          show_content_toolbar python:content_managment or clipboard">

    <div class="message" tal:condition="synchro" i18n:translate="cps_synchronizing">
    While the box is beeing synchronized, webmail features are limited to browsing.
    </div>
    <div tal:condition="edit_name">
     <a href="view"
        class="close_rename_form"
        title="close">
        <img src="cpsma_delete_file.png"/>
     </a>
     <form action="rename.html" method="post" class="rename_form"
          tal:define="max_size_reached_msg string:'max_size_reached';
                      js_snip python:'controlInputSize(this, %s, event, %s)' % (max_folder_size,
                       max_size_reached_msg)">
       <input type="text" name="new_name" id="new_name"
              tal:attributes="value here/simpleFolderName;
                              onkeyup js_snip"/>
       <input type="submit" name="submit" value="cpsma_change"  i18n:attributes="value"/>
     </form>
    </div>
    <div tal:condition="add_folder">
     <a href="view"
        class="close_rename_form"
        title="close">
        <img src="cpsma_delete_file.png"/>
     </a>
     <form action="addFolder.html" method="post" class="rename_form"
          tal:define="max_size_reached_msg string:max_size_reached;
                      js_snip python:'controlInputSize(this, %s, event, %s)' % (max_folder_size,
                      max_size_reached_msg)">
       <input type="text" name="name" value=""
              tal:attributes="onkeyup js_snip"/>
       <input type="submit" name="submit" value="cpsma_add" i18n:attributes="value"/>
     </form>
    </div>
    <div tal:condition="move_folder">
      <a href="view"
         class="close_rename_form"
         title="close">
        <img src="cpsma_delete_file.png"/>
      </a>
      <div class="rename_form">
        <metal:block use-macro="here/boxes_mailaccess/macros/basebox_moveview"/>
      </div>
    </div>
    <metal:block use-macro="here/messagelist_macros/mailbox_warning"/>
    <metal:block use-macro="here/messagelist_macros/actions_toolbar"/>

    <div id="maillist"
         tal:define="is_folder python:1">
    <form action="manageContent.html" method="post">
      <metal:block use-macro="here/messagelist_macros/messagelist"/>
      <script langage="javascript">
        truncateFields(32);
        pd_setupPage();
      </script>
    </form>
    </div>
    <div style="clear: both">&#160;</div>
  </metal:block>
</html>